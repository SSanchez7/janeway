{% extends "admin/core/base.html" %}
{% load static %}
{% load i18n %}
{% load hooks %}
{% load foundation %}

{% block title %}{% trans "Submit an Article" %}{% endblock title %}

{% block title-section %}{% trans "Author Agreement" %}{% endblock %}
{% block title-sub %}
    {% trans "Please carefully read through the statements below before checking items" %}{% endblock %}
{% block css %}
    <link href="{% static 'admin/css/timeline.css' %}" rel="stylesheet">
    <style>    
        .destroy-tag-selected {
            color: #999;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
            margin-right: 2px;
            &:hover {
                text-decoration: none;
            }
        }

<<<<<<< HEAD
{% block breadcrumbs %}
    {{ block.super }}
    <li>Submit an Article</li>
{% endblock %}

=======
        .select2-selection__choice {
            display: none;
        }
        .select2-selection--multiple {
            height: 40px;
        }
        .select2-selection__rendered {
            height: 40px;
        }
    
    </style>
{% endblock %}
>>>>>>> e3270df6 (add competing interest accounts)
{% block body %}
    <article>
        <form method="POST">
            <div id="content submission-content" class="box">
                {% csrf_token %}

                {% include "admin/submission/timeline.html" with data=article %}

                {% if request.journal.submissionconfiguration.publication_fees or request.journal.submissionconfiguration.submission_check or request.journal.submissionconfiguration.copyright_notice %}
                    <p>{% trans 'All authors must agree to the below statements in order to submit an article to' %} {{ request.journal.name }}. {% trans 'If you do not agree with these terms you will be unable to proceed with your submission.' %}</p>
                {% endif %}

                {% if request.journal.submissionconfiguration.publication_fees %}
                    <div class="title-area">
                        <h2>{% trans "Publication Fees" %}</h2>
                    </div>
                    <div class="content submission-content">
                        {{ journal_settings.general.publication_fees|safe }}
                        {% hook 'publication_fees' %}
                        <br />
                        {{ form.publication_fees }}&nbsp;&nbsp;<label
                            for="id_publication_fees">{% trans "Author(s) agrees to the above statement" %}</label>
                    </div>
                {% endif %}

                {% if request.journal.submissionconfiguration.submission_check %}
                    <div class="title-area">
                        <h2>{% trans "Submission Checklist" %}</h2>
                    </div>
                    <div class="content submission-content">
                        {{ journal_settings.general.submission_checklist|safe }}
                        <br />
                        {{ form.submission_requirements }}&nbsp;&nbsp;<label
                            for="id_submission_requirements">{% trans "Author(s) confirms that this article adheres to the above requirements" %}</label>
                    </div>
                {% endif %}

                {% if request.journal.submissionconfiguration.copyright_notice %}
                    <div class="title-area">
                        <h2>{% trans "Copyright Notice" %}</h2>
                    </div>
                    <div class="content submission-content">
                        {{ journal_settings.general.copyright_notice|safe }}
                        <br />
                        {{ form.copyright_notice }}&nbsp;&nbsp;<label
                            for="id_copyright_notice">{{ form.copyright_notice.label }}</label>
                    </div>
                {% endif %}

                {% if request.journal.submissionconfiguration.competing_interests %}
                    <div class="title-area">
                        <h2>{% trans "Competing Interests" %}</h2>
                    </div>

                    <div class="large-6 columns" style="margin-bottom: 16px;">
                        <p>{% trans "Search for users using email address or username. If an user is matched, they will be registered as a competing interest." %}</p>
                        <div class="large-6 columns" style="margin-bottom: 16px; padding: 0;">
                            {{ form.competing_interest_accounts }}
                            <p class="help-text" style="margin-top: 1px">{{ form.competing_interest_accounts.help_text}}</p>
                        </div>
                        
                        <table class="small scroll">
                            <thead>
                            <tr>
                                <th></th>
                                <th>{% trans "Name" %}</th>
                                <th>{% trans "Email" %}</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody class="competing-interests-accounts-container" id="sortable">
                        </table>
                    </div>

                    <div class="content submission-content">
                        {{ form.competing_interests|foundation }}
                    </div>
                {% endif %}
                <button class="success button pull-right" type="submit" name="start_submission"><i class="fa fa-check">&nbsp;</i>{% trans "Start Submission" %}
                </button>
                <br/>
            </div>
        </form>
    </article>

{% endblock body %}

{% block js %}
<script>
    $(document).ready(function() {
        $(".competing-interests-accounts").select2({
            tags: true,
            placeholder: "Search by email or user name"
        }).on('change', function() {
            var $selected = $(this).find('option:selected');
            var $container = $('.competing-interests-accounts-container');
            var $div = $('<div>');
            if ($selected.length === 0) {
                var $trDefault = $(
                    '<tr class="default-row">' +
                        '<td colspan="4">No items selected</td>' +
                    '</tr>'
                );
                $container.html('').append($trDefault);
                return;
            }

            $selected.each(function(k, v) {
                var username = $(v).text().split(" - ")[0];
                var email = $(v).text().split(" - ")[1];
                var $tr = $(
                    '<tr class="tag-selected" id="account-' + $(v).val() + '">' +
                        '<td><i class="fa fa-sort"></i></td>'+
                        '<td>' + username +'</td>'+
                        '<td>' + email + '</td>'+
                        '<td class="destroy-tag-selected"><a><i class="fa fa-trash">&nbsp;</i></a></td>'+
                    '</tr>'
                )
                $tr.children('td.destroy-tag-selected')
                    .off('click.select2-copy')
                    .on('click.select2-copy', function(e) {
                        var $opt = $(this).data('select2-opt');
                        $opt.attr('selected', false);
                        $opt.parents('select').trigger('change');
                    }).data('select2-opt', $(v));
                $div.append($tr);
            });
            $container.html('').append($div.children())
        }).trigger('change');
    });

</script>
    {{ form.media.js }}
    {{ form.media.css }}
{% endblock js %}
